<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <style>
        h2 {text-align: center;}
        form {background-color: lightgrey; }
        div {text-align: center;}
    </style>
    <meta charset="UTF-8">
    <title>Converter</title>
</head>
<body>
<form>
    <br>
    <h2>Конвертер валют</h2>
    <div>
        <select name="fromValute" id="fromValute" style="margin: 20px; width: 225px">
            <option th:each="currency : ${allCurrencies}" th:nominal ="${currency.nominal}" th:value="${currency.value}" th:label = "${currency.name}"></option>
        </select>
        <select name="toValute" id="toValute" style="margin: 20px; width: 225px">
            <option th:each="currency : ${allCurrencies}" th:nominal ="${currency.nominal}" th:value="${currency.value}" th:label = "${currency.name}"></option>
        </select>
        <br>
        <input type="text" name="fromAmount" id="fromAmount" style="margin: 20px">
        <input type="text" name="toAmount" id="toAmount" style="margin: 20px">
        <br>
        <button type="button" style="background-color: gray; width: 225px; margin: 20px" onclick="conversionIntoDB();">Конвертировать</button>
    </div>
</form>
<link rel="import" href="https://github.com/MikeMcl/big.js/blob/master/big.js">
<script type = "text/javascript">
    function conversionIntoDB(){
        let sumToConvert = document.getElementById("fromAmount").value;

        if (!checkValidation(sumToConvert)) return;
        sumToConvert = new Big(sumToConvert);
        alert(sumToConvert);
        let fromValute = document.getElementById("fromValute");
        let toValute = document.getElementById("toValute");
        alert(sumToConvert);
        let fromNominal = new Big(fromValute.options[fromValute.selectedIndex].attributes.getNamedItem("nominal").value);
        let fromValue = new Big(fromValute.options[fromValute.selectedIndex].attributes.getNamedItem("value").value);
        let toNominal = new Big(toValute.options[toValute.selectedIndex].attributes.getNamedItem("nominal").value);
        let toValue = new Big(toValute.options[toValute.selectedIndex].attributes.getNamedItem("value").value);
        alert(sumToConvert);
        let fromUnit = fromValue / fromNominal;
        let toUnit = toValue / toNominal;
        alert(sumToConvert);
        alert(fromNominal);
        alert(fromValue);
        alert(toNominal);
        alert(toValue);
        document.getElementById("toAmount").value = toUnit * sumToConvert / fromUnit;
    }

    function checkValidation(sumToConvert){
        let regexp = /(^\d{1,11}[.,]\d{1,4}$)|(^\d{1,11}$)/

        return regexp.test(sumToConvert);
    }
</script>
</body>

</html>